import React, { useState, useEffect } from "react";
import "@styles/tailwind.css";
import type { AppProps } from "next/app";
import Head from "next/head";

//libs
import { auth, db } from "@libs/firebaseConfig";

//types
import { UserAuthContextType } from "src/types/user/UserAuthContextType";

//contextAPI
export const IsUserContext = React.createContext<UserAuthContextType>({ currentUser: undefined });

function MyApp({ Component, pageProps }: AppProps) {
    const [currentUser, setCurrentUser] = useState(undefined);

    useEffect(() => {
        auth.onAuthStateChanged(async (user) => {
            //uidをグローバルstateとしてユーザーのログイン管理
            if (user) {
                // const userData = (await db.collection("users").doc(`${user.uid}`).get()).data();
                setCurrentUser(user.uid);
            }
        });
    }, []);

    return (
        <>
            <Head>
                <title>UN WORK</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width,initial-scale=1.0" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <IsUserContext.Provider value={currentUser}>
                <Component {...pageProps} />
            </IsUserContext.Provider>
        </>
    );
}

export default MyApp;
